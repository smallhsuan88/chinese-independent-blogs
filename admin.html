<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>作者後台入口</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --border: #e2e8f0;
      --accent: #2563eb;
      --accent-soft: #e9f0ff;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1222;
        --card: #0f172a;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --border: #1f2a3d;
        --accent: #60a5fa;
        --accent-soft: #0d1c37;
      }
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
      font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .card {
      width: min(520px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
    }

    h1 { margin: 0 0 8px; }

    p { margin: 0 0 16px; color: var(--muted); line-height: 1.7; }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
      color: var(--muted);
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: color-mix(in srgb, var(--card) 96%, transparent);
      font-size: 15px;
      color: var(--text);
    }

    button {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      font-size: 15px;
      cursor: pointer;
      background: linear-gradient(120deg, #2563eb, #1d4ed8);
      color: #fff;
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.25);
      transition: transform 0.08s ease, box-shadow 0.18s ease;
    }

    button:hover { transform: translateY(-1px); box-shadow: 0 12px 26px rgba(37, 99, 235, 0.28); }
    button:active { transform: translateY(0); box-shadow: none; }

    .status {
      margin-top: 12px;
      font-size: 14px;
      color: var(--muted);
      word-break: break-all;
    }

    .user-box {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      border: 1px dashed var(--border);
      background: var(--accent-soft);
      color: var(--text);
      line-height: 1.6;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="card">
    <h1>作者後台入口</h1>
    <p>請登入後管理文章。此頁僅做登入入口與狀態確認，後續草稿與發布功能將於下一階段補齊。</p>

    <label for="email">登入信箱（Magic Link）</label>
    <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />

    <button id="btnAuth">登入 / 登出</button>
    <div id="status" class="status">初始化中…</div>

    <div id="userBox" class="user-box" style="display:none;"></div>
  </div>

  <script>
    const SUPABASE_URL = "https://kxilbdbtzoscutxjzbss.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt4aWxiZGJ0em9zY3V0eGp6YnNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1MTQzMzgsImV4cCI6MjA4MjA5MDMzOH0.xWhjqKF9DeqY3t3RJaU4FoL1LRRkxgYkZ34L9fgFh8g";

    const { createClient } = supabase;
    const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const statusEl = document.getElementById("status");
    const btnAuth = document.getElementById("btnAuth");
    const emailInput = document.getElementById("email");
    const userBox = document.getElementById("userBox");

    function setStatus(msg) {
      statusEl.textContent = msg;
    }

    async function refreshSession() {
      const { data, error } = await sb.auth.getUser();
      if (error) {
        setStatus("讀取登入狀態失敗：" + error.message);
        userBox.style.display = "none";
        btnAuth.textContent = "重新登入";
        return;
      }

      const user = data?.user;
      if (!user) {
        setStatus("尚未登入，請輸入 email 取得登入連結。");
        userBox.style.display = "none";
        btnAuth.textContent = "寄送登入連結";
        return;
      }

      setStatus("已登入，可前往後台管理文章。");
      btnAuth.textContent = "登出";
      userBox.style.display = "block";
      userBox.innerHTML = `
        <div><strong>目前使用者：</strong>${user.email || "(無 email)"}</div>
        <div><strong>UID：</strong>${user.id}</div>
      `;
    }

    btnAuth.addEventListener("click", async () => {
      const { data } = await sb.auth.getUser();
      const user = data?.user;

      if (user) {
        await sb.auth.signOut();
        setStatus("已登出。");
        await refreshSession();
        return;
      }

      const email = emailInput.value.trim();
      if (!email) {
        setStatus("請輸入 email 後再送出。");
        return;
      }

      setStatus("寄送登入連結中…");
      const { error } = await sb.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: location.origin + location.pathname.replace(/\/[^\/]*$/, "/") + "admin.html"
        }
      });

      if (error) {
        setStatus("寄送失敗：" + error.message);
      } else {
        setStatus("已寄出登入連結，請到信箱點擊登入。");
      }
    });

    sb.auth.onAuthStateChange(() => refreshSession());
    refreshSession();
  </script>
</body>
</html>
