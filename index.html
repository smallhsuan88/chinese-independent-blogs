<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>極簡部落格</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f7f7f7;
      --card: #ffffff;
      --text: #111111;
      --border: #e0e0e0;
      --accent: #3b82f6;
      --muted: #6b7280;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f172a;
        --card: #1e293b;
        --text: #e2e8f0;
        --border: #334155;
        --accent: #60a5fa;
        --muted: #94a3b8;
      }
    }
    body {
      margin: 0;
      font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 32px 16px 64px;
    }
    .container {
      width: min(960px, 100%);
    }
    h1 {
      margin-top: 0;
      margin-bottom: 16px;
      letter-spacing: 0.02em;
    }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 0.05s ease, box-shadow 0.15s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
    }
    button:active {
      transform: translateY(0);
      box-shadow: none;
    }
    .posts {
      display: grid;
      gap: 20px;
    }
    .post {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    }
    .post-media {
      width: 100%;
      aspect-ratio: 3 / 1.4;
      object-fit: cover;
      display: block;
      background: #e5e7eb;
    }
    .post-body {
      padding: 16px;
      display: grid;
      gap: 8px;
    }
    .post header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .post h2 {
      margin: 0;
      font-size: 20px;
      line-height: 1.3;
    }
    .meta {
      font-size: 13px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .badge {
      display: inline-flex;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.1);
      color: var(--accent);
      font-weight: 600;
      font-size: 12px;
      letter-spacing: 0.02em;
    }
    .tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .tags .badge {
      background: rgba(148, 163, 184, 0.18);
      color: var(--muted);
      font-weight: 500;
    }
    .excerpt {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
    }
    .empty {
      text-align: center;
      color: var(--muted);
      font-size: 15px;
      padding: 32px 0;
    }
    .pagination {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 24px;
      align-items: center;
      flex-wrap: wrap;
      color: var(--muted);
    }
    .pagination button {
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 8px 14px;
      border-radius: 8px;
      font-size: 14px;
    }
    .pagination button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>極簡部落格</h1>
    <p class="meta">只列出已發佈的文章，包含封面、分類、標籤與預估閱讀時間。</p>
    <section id="postList" class="posts"></section>
    <div id="pagination" class="pagination"></div>
  </div>

  <script>
    const PAGE_SIZE = 3;
    const postList = document.getElementById('postList');
    const pagination = document.getElementById('pagination');
    let allPosts = [];
    let currentPage = 1;

    function formatDate(isoString) {
      const date = new Date(isoString);
      if (Number.isNaN(date.getTime())) return '未知日期';
      return date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
    }

    function computeReadingTimeMinutes(content) {
      const words = content.trim().split(/\s+/).filter(Boolean).length;
      return Math.max(1, Math.ceil(words / 200));
    }

    function renderPagination() {
      pagination.innerHTML = '';
      const totalPages = Math.ceil(allPosts.length / PAGE_SIZE) || 1;

      const info = document.createElement('span');
      info.textContent = `第 ${currentPage} / ${totalPages} 頁`;

      const prev = document.createElement('button');
      prev.textContent = '上一頁';
      prev.disabled = currentPage === 1;
      prev.onclick = () => {
        currentPage = Math.max(1, currentPage - 1);
        renderPosts();
      };

      const next = document.createElement('button');
      next.textContent = '下一頁';
      next.disabled = currentPage === totalPages;
      next.onclick = () => {
        currentPage = Math.min(totalPages, currentPage + 1);
        renderPosts();
      };

      pagination.append(prev, info, next);
    }

    function renderPosts() {
      postList.innerHTML = '';

      if (allPosts.length === 0) {
        postList.innerHTML = '<div class="empty">目前沒有發佈的文章。</div>';
        pagination.innerHTML = '';
        return;
      }

      const start = (currentPage - 1) * PAGE_SIZE;
      const slice = allPosts.slice(start, start + PAGE_SIZE);

      slice.forEach((post) => {
        const wrapper = document.createElement('article');
        wrapper.className = 'post';

        if (post.coverImage) {
          const img = document.createElement('img');
          img.className = 'post-media';
          img.src = post.coverImage;
          img.alt = `${post.title} 封面`;
          wrapper.appendChild(img);
        }

        const body = document.createElement('div');
        body.className = 'post-body';

        const header = document.createElement('header');
        const title = document.createElement('h2');
        title.textContent = post.title;
        header.append(title);

        const meta = document.createElement('div');
        meta.className = 'meta';
        const date = formatDate(post.publishedAt || post.createdAt);
        const readingTime = post.readingTimeMinutes || computeReadingTimeMinutes(post.content || '');
        meta.textContent = `${date} · ${readingTime} 分鐘閱讀`;

        const category = document.createElement('span');
        category.className = 'badge';
        category.textContent = post.category || '未分類';

        const excerpt = document.createElement('p');
        excerpt.className = 'excerpt';
        excerpt.textContent = post.excerpt || (post.content || '').slice(0, 120);

        const tags = document.createElement('div');
        tags.className = 'tags';
        (post.tags || []).forEach((tag) => {
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = tag;
          tags.appendChild(badge);
        });

        body.append(header, meta, category, excerpt);
        if (tags.childElementCount) {
          body.appendChild(tags);
        }
        wrapper.appendChild(body);
        postList.appendChild(wrapper);
      });

      renderPagination();
    }

    async function fetchPosts() {
      try {
        const response = await fetch('posts.json', { cache: 'no-store' });
        const data = await response.json();
        if (!Array.isArray(data)) throw new Error('posts.json 內容格式錯誤');
        allPosts = data
          .filter((post) => post.status === 'published')
          .sort((a, b) => new Date(b.publishedAt || b.createdAt || 0) - new Date(a.publishedAt || a.createdAt || 0));
        currentPage = 1;
        renderPosts();
      } catch (error) {
        postList.innerHTML = `<div class=\"empty\">載入文章列表時發生錯誤：${error.message}</div>`;
      }
    }

    fetchPosts();
  </script>
</body>
</html>
